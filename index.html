<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WWM - Super App</title>
    <link rel="stylesheet" href="styles-fixed.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#111827">
</head>
<body>
    <div class="container">
        <header>
            <h1>Super App</h1>
            <p class="subtitle">Your All-in-One Companion ‚Ä¢ <span class="copyright">Made by Will - MaiMaiYeuEm</span></p>
            <div class="header-buttons">
                <button id="themeToggleBtn" class="theme-toggle-btn" title="Toggle Dark/Light Theme">
                    <span class="theme-icon">üåô</span>
                </button>
                <div class="menu-dropdown">
                    <button id="menuBtn" class="menu-btn" title="Menu">
                        <span class="menu-icon">‚ò∞</span>
                    </button>
                    <div class="menu-content" id="menuContent">
                        <button id="exportBtn" class="menu-item">üì• Export Strategy</button>
                        <button id="importBtn" class="menu-item">üì§ Import Strategy</button>
                        <button id="hotKeyBtn" class="menu-item">‚å®Ô∏è Hot Keys</button>
                    </div>
                </div>
            </div>
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </header>
        
        <div class="tab-bar" role="tablist" aria-label="Main tabs">
            <button class="tab-btn active" data-tab="map" role="tab" aria-selected="true">Map</button>
            <button class="tab-btn" data-tab="roster" role="tab" aria-selected="false">Roster</button>
            <button class="tab-btn" data-tab="gacha" role="tab" aria-selected="false">Gacha üé∞</button>
        </div>

        <div class="tab-content active" id="tab-map" role="tabpanel">
            <div class="main-content">
                <!-- Member List Panel -->
                <div class="member-panel" id="memberPanel">
                    <div class="panel-content">
                        <h2>Guild Members <span id="playerCount">(0/30)</span>
                            <button id="managePlayersBtn" class="manage-players-btn" title="Manage Players">‚öôÔ∏è</button>
                        </h2>
                    <div class="enemy-section">
                        <button id="addEnemiesBtn" class="add-enemies-btn">
                            ‚öîÔ∏è Add 5 Enemies (<span id="enemyCount">0</span>/30)
                        </button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search players...">
                    </div>
                    <div class="view-toggle">
                        <button class="view-toggle-btn active" data-view="grouped">Grouped by Team</button>
                        <button class="view-toggle-btn" data-view="list">All Players</button>
                    </div>
                    <div class="role-filters">
                        <button class="role-filter-btn active" data-role="all">All Roles</button>
                        <button class="role-filter-btn" data-role="Tank">Tank</button>
                        <button class="role-filter-btn" data-role="DPS">DPS</button>
                        <button class="role-filter-btn" data-role="Healer">Healer</button>
                    </div>
                        <div id="memberList" class="member-list"></div>
                    </div>
                </div>
                
                <!-- Map Area -->
                <div class="map-panel">
                    <h2>Battle Map <span id="placedCount">(0/30 Placed)</span></h2>
                    <div id="selectionHint" class="selection-hint" style="display: none;">
                        ‚úì Player selected - Click on map to place
                    </div>
                    
                    <div id="mapArea" class="map-area">
                        <canvas id="drawingCanvas" class="drawing-canvas"></canvas>
                        <div class="map-placeholder">
                            <p class="instruction">Click a player from the list, then click on the map to place them</p>
                        </div>
                    </div>
                    
                    <!-- Tools Toolbar at Bottom -->
                    <div class="bottom-toolbar" id="toolsToolbar">
                        <div class="toolbar-buttons">
                            <button id="addObjectiveBtn" class="toolbar-btn objective-btn" title="Add Objective Marker">
                                <span class="btn-icon">üéØ</span>
                            </button>
                            <button id="addBossBtn" class="toolbar-btn boss-btn" title="Add Boss Marker">
                                <img src="images/boss.png" alt="Boss" class="btn-icon-img">
                            </button>
                            <button id="addBlueTowerBtn" class="toolbar-btn blue-tower-btn" title="Add Ally Tower (Blue)">
                                <img src="images/tower_blue.png" alt="Blue Tower" class="btn-icon-img">
                            </button>
                            <button id="addRedTowerBtn" class="toolbar-btn red-tower-btn" title="Add Enemy Tower (Red)">
                                <img src="images/tower_red.png" alt="Red Tower" class="btn-icon-img">
                            </button>
                            <button id="addBlueTreeBtn" class="toolbar-btn blue-tree-btn" title="Add Ally Tree (Blue)">
                                <img src="images/tree_blue.png" alt="Blue Tree" class="btn-icon-img">
                            </button>
                            <button id="addRedTreeBtn" class="toolbar-btn red-tree-btn" title="Add Enemy Tree (Red)">
                                <img src="images/tree_red.png" alt="Red Tree" class="btn-icon-img">
                            </button>
                            <button id="addBlueGooseBtn" class="toolbar-btn blue-goose-btn" title="Add Ally Goose (Blue)">
                                <img src="images/goose_blue.png" alt="Blue Goose" class="btn-icon-img">
                            </button>
                            <button id="addRedGooseBtn" class="toolbar-btn red-goose-btn" title="Add Enemy Goose (Red)">
                                <img src="images/goose_red.png" alt="Red Goose" class="btn-icon-img">
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button id="drawBtn" class="toolbar-btn draw-btn" title="Toggle Draw Mode">
                                <span class="btn-icon">‚úèÔ∏è</span>
                            </button>
                            <div class="toolbar-color-picker">
                                <label for="drawColorPicker" class="color-picker-label" title="Choose Drawing Color">
                                    <input type="color" id="drawColorPicker" value="#ff0000">
                                </label>
                            </div>
                            <button id="undoDrawBtn" class="toolbar-btn undo-btn" title="Undo Drawing" disabled>
                                <span class="btn-icon">‚Ü∂</span>
                            </button>
                            <button id="redoDrawBtn" class="toolbar-btn redo-btn" title="Redo Drawing" disabled>
                                <span class="btn-icon">‚Ü∑</span>
                            </button>
                            <button id="clearDrawBtn" class="toolbar-btn clear-draw-btn" title="Clear All Drawings">
                                <span class="btn-icon">üßπ</span>
                            </button>
                            <div class="toolbar-toggle-option">
                                <label class="toggle-label-small" title="Auto-delete drawings after 10 seconds">
                                    <input type="checkbox" id="autoDeleteToggle" />
                                    <span class="toggle-slider-small"></span>
                                    <span class="toggle-text-small">Auto-delete</span>
                                </label>
                            </div>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button id="clearMapBtn" class="toolbar-btn clear-btn" title="Clear All Placements">
                                <span class="btn-icon">‚ùå</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-roster" role="tabpanel" aria-hidden="true">
            <div class="roster-panel">
                <div class="roster-header">
                    <h2>Roster</h2>
                    <p>Paste a Google Sheet link to load roster data.</p>
                </div>
                <div class="roster-controls">
                    <input type="text" id="sheetLinkInput" class="roster-input" placeholder="https://docs.google.com/spreadsheets/d/...">
                    <button id="loadSheetBtn" class="roster-btn">Load Sheet</button>
                </div>
                <div id="rosterStatus" class="roster-status" aria-live="polite"></div>
                <div class="roster-table-wrapper">
                    <table class="roster-table">
                        <thead id="rosterTableHead"></thead>
                        <tbody id="rosterTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="tab-content" id="tab-gacha" role="tabpanel" aria-hidden="true">
            <div class="gacha-panel">
                <div class="gacha-header">
                    <h2>üé∞ Gacha Slot Counter</h2>
                    <p class="gacha-subtitle">Track your pulls and luck!</p>
                </div>

                <div class="gacha-container">
                    <div class="gacha-main">
                        <!-- Slot Selection Area -->
                        <div class="gacha-slots">
                            <div class="slots-grid">
                                <div class="slot-box" data-slot="Slot1">
                                    <h3>Slot 1</h3>
                                    <div class="slot-selection">
                                        <button class="color-btn white-btn" data-slot="Slot1" data-color="White" title="Select White">‚ö™</button>
                                        <button class="color-btn purple-btn" data-slot="Slot1" data-color="Purple" title="Select Purple">üü£</button>
                                        <button class="color-btn gold-btn" data-slot="Slot1" data-color="Gold" title="Select Gold">üü°</button>
                                    </div>
                                    <div class="slot-selected-color" id="slot1-color">None</div>
                                    <button class="slot-counter-btn" data-slot="Slot1" title="Increment counter">Count: <span class="counter-value">0</span></button>
                                </div>

                                <div class="slot-box" data-slot="Slot2">
                                    <h3>Slot 2</h3>
                                    <div class="slot-selection">
                                        <button class="color-btn white-btn" data-slot="Slot2" data-color="White" title="Select White">‚ö™</button>
                                        <button class="color-btn purple-btn" data-slot="Slot2" data-color="Purple" title="Select Purple">üü£</button>
                                        <button class="color-btn gold-btn" data-slot="Slot2" data-color="Gold" title="Select Gold">üü°</button>
                                    </div>
                                    <div class="slot-selected-color" id="slot2-color">None</div>
                                    <button class="slot-counter-btn" data-slot="Slot2" title="Increment counter">Count: <span class="counter-value">0</span></button>
                                </div>

                                <div class="slot-box" data-slot="Slot3">
                                    <h3>Slot 3</h3>
                                    <div class="slot-selection">
                                        <button class="color-btn white-btn" data-slot="Slot3" data-color="White" title="Select White">‚ö™</button>
                                        <button class="color-btn purple-btn" data-slot="Slot3" data-color="Purple" title="Select Purple">üü£</button>
                                        <button class="color-btn gold-btn" data-slot="Slot3" data-color="Gold" title="Select Gold">üü°</button>
                                    </div>
                                    <div class="slot-selected-color" id="slot3-color">None</div>
                                    <button class="slot-counter-btn" data-slot="Slot3" title="Increment counter">Count: <span class="counter-value">0</span></button>
                                </div>

                                <div class="slot-box" data-slot="Slot4">
                                    <h3>Slot 4</h3>
                                    <div class="slot-selection">
                                        <button class="color-btn white-btn" data-slot="Slot4" data-color="White" title="Select White">‚ö™</button>
                                        <button class="color-btn purple-btn" data-slot="Slot4" data-color="Purple" title="Select Purple">üü£</button>
                                        <button class="color-btn gold-btn" data-slot="Slot4" data-color="Gold" title="Select Gold">üü°</button>
                                    </div>
                                    <div class="slot-selected-color" id="slot4-color">None</div>
                                    <button class="slot-counter-btn" data-slot="Slot4" title="Increment counter">Count: <span class="counter-value">0</span></button>
                                </div>

                                <div class="slot-box" data-slot="Slot5">
                                    <h3>Slot 5</h3>
                                    <div class="slot-selection">
                                        <button class="color-btn white-btn" data-slot="Slot5" data-color="White" title="Select White">‚ö™</button>
                                        <button class="color-btn purple-btn" data-slot="Slot5" data-color="Purple" title="Select Purple">üü£</button>
                                        <button class="color-btn gold-btn" data-slot="Slot5" data-color="Gold" title="Select Gold">üü°</button>
                                    </div>
                                    <div class="slot-selected-color" id="slot5-color">None</div>
                                    <button class="slot-counter-btn" data-slot="Slot5" title="Increment counter">Count: <span class="counter-value">0</span></button>
                                </div>
                            </div>
                        </div>

                        <!-- Confirm Button -->
                        <div class="gacha-confirm-section">
                            <button id="gacha-confirm-btn" class="gacha-confirm-btn">‚úÖ Confirm Pull</button>
                            <button id="gacha-back-btn" class="gacha-back-btn">‚Üê Back</button>
                        </div>
                    </div>

                    <!-- Statistics Panel -->
                    <div class="gacha-stats">
                        <div class="stats-box">
                            <h3>Total Pulls</h3>
                            <div class="stat-number" id="gacha-total-pulls">0</div>
                        </div>
                        <div class="stats-box">
                            <h3>Session Pulls</h3>
                            <div class="stat-number" id="gacha-session-pulls">0</div>
                        </div>
                        <div class="stats-box">
                            <h3>Sessions</h3>
                            <div class="stat-number" id="gacha-session-count">0</div>
                        </div>
                        <div class="stats-box">
                            <h3>Avg/Session</h3>
                            <div class="stat-number" id="gacha-avg-pulls">0</div>
                        </div>
                    </div>
                </div>

                <!-- History Section -->
                <div class="gacha-history-section">
                    <h3>Pull History</h3>
                    <div class="gacha-history-controls">
                        <button id="gacha-export-btn" class="gacha-history-btn">üì• Export</button>
                        <button id="gacha-import-btn" class="gacha-history-btn">üì§ Import</button>
                        <button id="gacha-clear-btn" class="gacha-history-btn gacha-danger-btn">üóëÔ∏è Clear</button>
                    </div>
                    <div class="gacha-history" id="gacha-history"></div>
                </div>

                <input type="file" id="gacha-import-file" accept=".json" style="display: none;">
            </div>
        </div>

    </div>
    
    <!-- Player Management Popup -->
    <div id="playerManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Players</h2>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-toolbar">
                    <button id="addNewPlayerBtn" class="btn-primary">+ Add New Player</button>
                </div>
                
                <div class="player-management-list" id="playerManagementList">
                    <!-- Players will be rendered here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Player Edit Form Popup -->
    <div id="playerEditModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="editModalTitle">Add New Player</h2>
                <button class="modal-close" id="closeEditModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="playerEditForm">
                    <input type="hidden" id="editPlayerId" value="">
                    <div class="form-group">
                        <label for="editPlayerName">Name:</label>
                        <input type="text" id="editPlayerName" required maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="editPlayerRole">Role:</label>
                        <select id="editPlayerRole" required>
                            <option value="Tank">Tank</option>
                            <option value="DPS">DPS</option>
                            <option value="Healer">Healer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPlayerTeam">Team:</label>
                        <select id="editPlayerTeam" required>
                            <option value="Team 1">Team 1</option>
                            <option value="Team 2">Team 2</option>
                            <option value="Team 3">Team 3</option>
                            <option value="Team 4">Team 4</option>
                            <option value="Team 5">Team 5</option>
                            <option value="Team 6">Team 6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPlayerWeapon1">Weapon 1:</label>
                        <select id="editPlayerWeapon1" required>
                            <option value="Nameless Sword">Nameless Sword</option>
                            <option value="Nameless Spear">Nameless Spear</option>
                            <option value="Stormbreaker Spear">Stormbreaker Spear</option>
                            <option value="Thundercry Blade">Thundercry Blade</option>
                            <option value="Infernal Twinblades">Infernal Twinblades</option>
                            <option value="Mortal Rope Dart">Mortal Rope Dart</option>
                            <option value="Vernal Umbrella">Vernal Umbrella</option>
                            <option value="Inkwell Fan">Inkwell Fan</option>
                            <option value="Panacea Fan">Panacea Fan</option>
                            <option value="Soulshade Umbrella">Soulshade Umbrella</option>
                            <option value="Heavenquaker Spear">Heavenquaker Spear</option>
                            <option value="Strategic Sword">Strategic Sword</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPlayerWeapon2">Weapon 2:</label>
                        <select id="editPlayerWeapon2" required>
                            <option value="Nameless Sword">Nameless Sword</option>
                            <option value="Nameless Spear">Nameless Spear</option>
                            <option value="Stormbreaker Spear">Stormbreaker Spear</option>
                            <option value="Thundercry Blade">Thundercry Blade</option>
                            <option value="Infernal Twinblades">Infernal Twinblades</option>
                            <option value="Mortal Rope Dart">Mortal Rope Dart</option>
                            <option value="Vernal Umbrella">Vernal Umbrella</option>
                            <option value="Inkwell Fan">Inkwell Fan</option>
                            <option value="Panacea Fan">Panacea Fan</option>
                            <option value="Soulshade Umbrella">Soulshade Umbrella</option>
                            <option value="Heavenquaker Spear">Heavenquaker Spear</option>
                            <option value="Strategic Sword">Strategic Sword</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelEditBtn">Cancel</button>
                        <button type="submit" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="confirmModalTitle">Confirm Action</h2>
            </div>
            <div class="modal-body">
                <p id="confirmModalMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="confirmCancelBtn">Cancel</button>
                <button class="btn-danger" id="confirmOkBtn">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Prompt Modal -->
    <div id="promptModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="promptModalTitle">Input</h2>
            </div>
            <div class="modal-body">
                <p id="promptModalMessage"></p>
                <input type="text" id="promptModalInput" class="prompt-input" placeholder="Enter value...">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="promptCancelBtn">Cancel</button>
                <button class="btn-primary" id="promptOkBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Team Customization Modal -->
    <div id="teamCustomizeModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Customize Team</h2>
            </div>
            <div class="modal-body">
                <p>Team Name:</p>
                <input type="text" id="teamCustomizeName" class="prompt-input" placeholder="Enter team name...">
                <p style="margin-top: 12px;">Team Color:</p>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="color" id="teamCustomizeColor" style="width: 50px; height: 40px; cursor: pointer;">
                    <span id="teamCustomizeColorValue" style="font-size: 12px;">#FF6B6B</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="teamCustomizeCancelBtn">Cancel</button>
                <button class="btn-primary" id="teamCustomizeOkBtn">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Hotkey Help Modal -->
    <div id="hotkeyHelpModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Keyboard Shortcuts</h2>
                <button class="modal-close" id="closeHotkeyModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="hotkey-list">
                    <div class="hotkey-item">
                        <span class="hotkey-key">Shift + ?</span>
                        <span class="hotkey-desc">Show this help</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">O</span>
                        <span class="hotkey-desc">Add Objective</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">B</span>
                        <span class="hotkey-desc">Add Boss</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">1</span>
                        <span class="hotkey-desc">Add Blue Tower (Ally)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">2</span>
                        <span class="hotkey-desc">Add Red Tower (Enemy)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">3</span>
                        <span class="hotkey-desc">Add Blue Tree (Ally)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">4</span>
                        <span class="hotkey-desc">Add Red Tree (Enemy)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">5</span>
                        <span class="hotkey-desc">Add Blue Goose (Ally)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">6</span>
                        <span class="hotkey-desc">Add Red Goose (Enemy)</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">D</span>
                        <span class="hotkey-desc">Toggle Draw Mode</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">Ctrl + Z</span>
                        <span class="hotkey-desc">Undo Drawing</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">Ctrl + Y</span>
                        <span class="hotkey-desc">Redo Drawing</span>
                    </div>
                    <div class="hotkey-item">
                        <span class="hotkey-key">Esc</span>
                        <span class="hotkey-desc">Deselect Tool</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="data.js"></script>
    <script src="app.js"></script>
    <script src="gacha.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js');
            });
        }
    </script>
</body>
</html>
